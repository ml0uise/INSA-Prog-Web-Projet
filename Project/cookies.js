/*

            The holy cookie shall visit you.

       Can it lives in your session for the day?

        [ X ] YES               [   ] Also YES

⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠿⠛⠋⠉⠀⠀⠀⠘⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠟⠉⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡻⠋⠁⠀⠀⠀⠀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠉⠙⠻⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
⣿⣿⣿⣿⣿⣿⣿⣿⣻⠋⠀⠀⠀⠠⠖⠋⠉⠀⠀⠀⠀⣾⠉⢳⠀⠀⠀⠀⠀⠻⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
⣿⣿⣿⣿⣿⣿⡿⡱⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⠛⠉⠀⠀⠀⠐⠲⠦⣄⠉⠉⠻⣿⣿⣿⡿⠟⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
⣿⣿⣿⣿⣿⣿⢱⠁⠀⠀⠀⠀⣠⢤⡄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠁⠀⠀⠀⠀⠀⠀⠀⠘⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
⣿⣿⣿⣿⣿⡇⡆⠀⠀⠀⠀⠠⠷⠴⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢻⣿⣿⡿⠿⠿⠻⣿⣿⣿
⣿⣿⣿⣿⣿⠃⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⣀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⣄⡀⠀⠀⠀⠀⢠⡞⠳⣆⠈⣿⡀⠀⣠⠄⠀⢸⣿⣿
⣿⣿⣿⣿⣿⢰⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⠿⣦⡀⠀⠀⠀⠀⠀⠀⣰⡿⠏⠁⠀⠀⠀⠀⠀⠘⢧⣠⠟⠀⢹⣧⠈⠀⠀⣀⣾⣿⣿
⣿⣿⣿⣿⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣴⣾⠟⠁⠀⠀⠀⠀⠀⠀⠙⠿⣴⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⣷⣶⣶⣿⣿⣿⣿⣿
⣿⣿⣿⣿⡏⠀⠀⠀⠀⢸⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⣿⣿⣿⣿⣿⣿⣿⣿
⣿⣿⣿⣿⣧⢰⠀⠀⠀⢸⠀⠀⠀⠀⠀⠀⠀⠀⠀⣾⠛⠛⠛⠉⠉⠉⠉⠙⣷⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣾⣿⣿⣿⣿⣿⣿⣿⣿
⣿⣿⣿⣿⣿⡄⡆⠀⠀⠈⠂⠀⠀⠀⠀⠀⠀⠀⠀⢻⡀⠀⠀⠀⠀⠀⠀⢠⡏⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣼⣿⣿⣿⣿⣿⣿⣿⣿⣿
⣿⣿⣿⣿⣿⣿⣸⠀⠀⢀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⢳⡴⠶⣶⣶⣀⣠⠟⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⡤⢠⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
⣿⣿⣿⣿⣿⣿⡿⠀⠀⠈⢧⠀⠀⠀⣀⠀⠀⠀⠀⠀⠀⠙⠻⢥⡤⠞⠉⠀⠀⠀⠀⠀⠀⠀⠀⠐⠚⠉⢰⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
⣿⣿⣿⣿⣿⣿⣇⡄⠀⡠⠈⢧⣺⣍⠉⣻⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⠤⠤⢄⡀⠀⠀⠀⠀⣴⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
⣿⣿⣿⣿⣿⣿⣿⢣⠘⠁⠀⠀⢳⣍⠉⠁⠀⠀⠀⠀⠐⠢⣤⣀⡀⠀⠀⠀⠛⠦⠤⠞⠁⠀⠀⣠⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
⣿⣿⣿⣿⣿⣿⣿⣯⣢⣄⣀⣀⣼⣿⣷⣦⡀⠀⠀⠀⠀⠀⠀⠀⠁⠀⠀⠀⠀⠀⠀⣀⣠⣴⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠟⠳⠶⠤⣤⣤⣤⣤⣤⣤⠴⠶⠞⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠀⠀⠀⠀⢸⣿⣿⣿⣿⡇⠀⠀⠀⢸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣾⠀⠔⠒⠚⣿⣿⣿⣿⣴⠀⠠⠔⠚⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⣣⣀⡀⢀⣹⣿⣿⣿⣯⣆⡀⠀⠀⠈⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿

*/

document.cookie = "easter_egg=\"Thanks for inviting this cookie in your session\"";



const HIGHSCORE_LIMIT = 8;  // Number of highscores to keep


class Player {
    constructor (name, score) {
        this.name = name;
        this.score = score;
    }
}


function get_score_session() {
    let score = sessionStorage.getItem("score");

    if (score === null) {
        return -42
    } else {
        return score;
    }
}

function set_score_session(score) {
    sessionStorage.setItem("score", String(score));
}



function get_name() {
    let name = sessionStorage.getItem("name");

    if (name === null) {
        return change_name();
    } else {
        return name;
    }
}

function change_name() {
    let old_name = sessionStorage.getItem("name");
    let def;

    if (old_name === null) {
        def = "Player";
    } else {
        def = old_name;
    }

    let name = prompt("Enter your name: ", def);

    sessionStorage.setItem("name", name);

    return name;
}



function get_highscores() {
    // Example: [Player1, Player2, ...]
    // Ordered by score

    let scores = sessionStorage.getItem("highscores");

    if (scores === null) {
        return []
    } else {
        return JSON.parse(scores)
    }
}

function update_highscores(score) {
    change_name(); // After tests, it seems better to let the player change name anytime

    let actual = get_highscores();
    let player = new Player(get_name(), score);

    // Insert new highscore
    actual.push(player);
    actual.sort(function (a, b) {return b.score - a.score});  // Sort new highscore

    actual.slice(HIGHSCORE_LIMIT);  // Only keep a few highscores
    
    sessionStorage.setItem("highscores", JSON.stringify(actual));
}
